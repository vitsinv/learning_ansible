<h1>Домашнее задание к занятию "10.06. Инцидент-менеджмент"</h1>
<h2 dir="auto">Задание 1</h2>
<p dir="auto">Составьте постмотрем, на основе реального сбоя системы Github в 2018 году.</p>
<p dir="auto">Информация о сбое доступна <a href="https://habr.com/ru/post/427301/" rel="nofollow">в виде краткой выжимки на русском языке</a> , а
также <a href="https://github.blog/2018-10-30-oct21-post-incident-analysis/" rel="nofollow">развёрнуто на английском языке</a>.</p>

-------------
<h2>Краткое описание инцидента</h2>
<p>21.10.2018г. в 22:52 UTC из-за проблем сетевого взаимодействия и, в результате, последующего сбоя в работе БД, некоторые службы GitHub выдавали неверную информацию. Время восстановления составило 24 часа 11 минут.</p>

<h2>Предшествующие события</h2>
<p>Проведение работ по замене 100Gb сетевого оборудования и потеря связи между 
основным ЦОД US East Coast и Сетевым ядром US West Coast</p>

<h2>Причина инцидента</h2>
<p>Рассогласование кластеров MySQL в результате потери связи между сетевым ядром US West Coast и ЦОД US East Coast в течении 43 сек и некорректной настройки репликатора MySQL.</p>

<h2>Воздействие</h2>
<p>В течении 24 часов 11 минут пользователи получали неактуальную информацию, не работали Issues и Webhook.</p>

<h2>Обнаружение</h2>
<p>С 22:54 21 октября в систему мониторинга стали приходить сообщения об ошибках (алерты), в результате их обработки в 23:02 был обнаружен и зафиксирован переход кластеров БД в состояние Unexpected.

<h2>Реакция</h2>
Ручная остановка деплоя, перевод статуса системы в "желтый"
Передача инцидента координатору инцидентов. Изменение статуса системы на "красный"
Подключение инженеров администрирования БД
Отключение части сервисов для снижения нагрузки и предотвращения потери данных.

<h2>Восстановление</h2>
Восстановление полной производительности было выполнено за счет:

- восстановления данных из бэкаповх и повторных репликаций всех имеющихся данных с хостов с актуальными данными для восстановления 100% целостности данных во всех кластерах хранения данных. 
- Последующее включение всех сервисов и выполнение сопившихся в беклоге задач.

<h2>Таймлайн</h2>
	
- 2018.10.21 22:52 UTC - Потеря связи между серверами. После восстановления связи была попытка восстановления целостности кластера, восстановления консенсуса, но данные в БД различялись что привело к несогласованности в рамках кластера.
- 2018.10.21 22:54 UTC - Генерация алертов системой мониторинга, обработка дежурными инженерами поддержки.
- 2018.10.21 23:02 UTC обнаружение несоответсвие статуса кластера БД ожидаемому. Выявлено отсутствие серверов из US East Coast.
- 2018.10.21 23:07 UTC - отключены внутренние инструменты развертывания для предотвращения дополнительных изменений. 
- 2018.10.21 23:13 UTC - после выявления воздействия были привлечены дополнительные инженеры, выполнены действия для сохранения пользоательских данных. Деградация системы основлена не была.
- 2018.10.21 23:19 Система переведена в желтый статус и автоматически зафиксирован инцидент в системе управления сбоями.
- 2018.10.21 23:19 UTC - Были остановлены некоторые процессы (принудительная деградация системы) с целью повышения скорости восстановления.
- 2018.10.21 23:21 UTC - Привлечение координатора по инцидентам. Смена статуса системы на красный.
- 2018.10.22 00:05 UTC - Разработка плана по восстановления системы и синхронизаии репликаций данных. Обновлен статус, чтобы сообщить пользователям, что планируется выполнить контролируемую отработку отказа внутренней системы хранения данных.
- 2018.10.22 00:41 UTC - Запущен процесс бэкапирования данных, мониторинг состяния работ.
- 2018.10.22 06:51 UTC - бэкапы выполнены в US East Coast data center и запущена репликация в West Coast.
- 2018.10.22 07:46 UTC - опубликована расширенная информация для пользователей.
- 2018.10.22 11:12 UTC - Восстановлены сервера в US East Coast, продолжается репликация. Зафиксирована повышенная нагрузка при репликации.
- 2018.10.22 13:15 UTC - Зафиксировано пиковое значение нагрузки на систему. Было увеличено число реплик MySql в режиме RO.
- 2018.10.22 16:24 UTC - Репликация завершена, инициировано переключение в штатную топологию MySQL.
- 2018.10.22 16:45 UTC - После восстановления возникла необходимость балансировки нагрузки да восстановления 100% услуг клиентам. Для восстановления уже имеющихся данных пользователей включили обработку, так же подняли TTL до полного завершения и возвращения к штатной работе.
- 2018.10.22 23:03 UTC - Работа возвращена к шаттному поведению

<h2>Последующие действия</h2>

- В процессе восстановления были собраны логи серверов MySQL с данными, которые не были реплицированы на западное побережье. Проводится анализ чтобы определить, сколько их них получится восстановить автоматически.
- Исправление конфигурацию Orchestrator, в целях предотвращения передачи primary роли между регионами.
- Доработка системы мониторинга и оповещения о статусе системы, в целя повышения информативности, оповещения о статусе отдельных компонентах сервиса.
- Продолжение ранее начатых работ по улучшению отказоустойчивости сервиса, чтобы система оставалась доступной даже при отказе целого датацентра.
- Зафиксирован ряд инициатив в целях повышения отказоустойчивости сервиса, в том числе привлечение дополнительных инвестиций.
